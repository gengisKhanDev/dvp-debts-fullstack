<section class="page space-y-4">
	@if (vm$ | async; as vm) {
	<ui-page-header title="Editar deuda" subtitle="Actualiza la información del acreedor y el monto.">
		<div actions>
			<ui-button variant="ghost" size="sm" type="button" (click)="goDetail(vm.id)">← Volver</ui-button>
		</div>
	</ui-page-header>

	@if (saveError) {
	<ui-alert tone="danger" [message]="saveError" />
	}

	@if (vm.loading) {
	<ui-card>
		<div class="space-y-3">
			<ui-skeleton [width]="220" [height]="18" />
			<ui-skeleton [width]="320" />
			<ui-skeleton [width]="260" />
			<div class="flex gap-2 pt-2">
				<ui-skeleton [width]="110" [height]="34" />
				<ui-skeleton [width]="110" [height]="34" />
			</div>
		</div>
	</ui-card>
	} @else {
	@if (vm.error) {
	<ui-alert tone="danger" [message]="vm.error" />
	} @else {
	@if (!vm.debt) {
	<ui-alert tone="info" message="No se encontró la deuda." />
	} @else {
	@if (vm.debt.status === 'PAID') {
	<ui-alert tone="warning" message="Esta deuda ya está pagada ✅ (no se puede modificar)" />
	}

	<ui-card>
		<form class="space-y-4" [formGroup]="form" (ngSubmit)="submit(vm.id, vm.debt)">
			<ui-form-field label="Nombre del acreedor" [required]="true"
				[error]="form.controls.creditorName.touched && form.controls.creditorName.invalid ? 'Este campo es requerido' : null">
				<ui-input formControlName="creditorName" />
			</ui-form-field>

			<div class="grid gap-4 sm:grid-cols-2">
				<ui-form-field label="Email del acreedor" [required]="true"
					[error]="form.controls.creditorEmail.touched && form.controls.creditorEmail.invalid ? 'Email inválido' : null">
					<ui-input type="email" formControlName="creditorEmail" autocomplete="email" />
				</ui-form-field>

				<ui-form-field label="Teléfono del acreedor" [required]="true"
					[error]="form.controls.creditorPhone.touched && form.controls.creditorPhone.invalid ? 'Este campo es requerido' : null">
					<ui-input formControlName="creditorPhone" />
				</ui-form-field>
			</div>

			<ui-form-field label="Monto" [required]="true"
				[error]="form.controls.amount.touched && form.controls.amount.invalid ? 'Monto debe ser mayor a 0' : null">
				<ui-input type="number" formControlName="amount" [min]="0.01" [step]="0.01" />
			</ui-form-field>

			<ui-form-field label="Descripción" [hint]="'Opcional'">
				<ui-textarea [rows]="3" formControlName="description" />
			</ui-form-field>

			<div class="flex flex-wrap gap-2 pt-2">
				<ui-button variant="soft" type="submit"
					[disabled]="saving || vm.debt.status === 'PAID' || form.invalid">
					@if (saving) { Guardando... } @else { Guardar cambios }
				</ui-button>

				<ui-button variant="ghost" type="button" (click)="goDetail(vm.id)">Cancelar</ui-button>
			</div>
		</form>
	</ui-card>
	}
	}
	}
	}
</section>