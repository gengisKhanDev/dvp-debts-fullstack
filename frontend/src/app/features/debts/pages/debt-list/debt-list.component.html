<section class="space-y-4">
	<div class="flex items-center justify-between gap-3">
		<h1 class="text-xl font-semibold">Mis deudas</h1>

		<div class="flex items-center gap-2">
			<a routerLink="/debts/new" class="rounded-xl bg-white/10 px-3 py-1 hover:bg-white/15 text-sm">
				+ Nueva deuda
			</a>

			<button class="rounded-xl border border-white/10 px-3 py-1 hover:bg-white/5 text-sm disabled:opacity-50"
				type="button" [disabled]="exportLoading" (click)="export('csv')">
				@if (exportLoading) { Exportando... } @else { Export CSV }
			</button>

			<button class="rounded-xl border border-white/10 px-3 py-1 hover:bg-white/5 text-sm disabled:opacity-50"
				type="button" [disabled]="exportLoading" (click)="export('json')">
				@if (exportLoading) { Exportando... } @else { Export JSON }
			</button>

			<button class="rounded-xl border border-white/10 px-3 py-1 hover:bg-white/5 text-sm" type="button"
				(click)="reload()">
				Recargar
			</button>
		</div>
	</div>

	@if (exportError) {
	<div class="rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm">
		{{ exportError }}
	</div>
	}

	<!-- SUMMARY -->
	@if (summaryVm$ | async; as s) {
	@if (s.loading) {
	<div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
		@for (_ of [1,2,3,4]; track _) {
		<div class="rounded-2xl border border-white/10 p-4 space-y-2">
			<ui-skeleton [width]="120" [height]="12" />
			<ui-skeleton [width]="160" [height]="18" />
		</div>
		}
	</div>
	} @else {
	@if (s.error) {
	<div class="rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm">
		{{ s.error }}
	</div>
	} @else {
	<div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
		<div class="rounded-2xl border border-white/10 p-4">
			<div class="text-xs opacity-70">Pendientes</div>
			<div class="mt-1 text-lg font-semibold">{{ s.summary!.pendingCount }}</div>
			<div class="mt-1 text-sm opacity-80">${{ s.summary!.pendingTotal }}</div>
		</div>

		<div class="rounded-2xl border border-white/10 p-4">
			<div class="text-xs opacity-70">Pagadas</div>
			<div class="mt-1 text-lg font-semibold">{{ s.summary!.paidCount }}</div>
			<div class="mt-1 text-sm opacity-80">${{ s.summary!.paidTotal }}</div>
		</div>

		<div class="rounded-2xl border border-white/10 p-4">
			<div class="text-xs opacity-70">Total</div>
			<div class="mt-1 text-lg font-semibold">{{ s.summary!.totalCount }}</div>
			<div class="mt-1 text-sm opacity-80">${{ s.summary!.overallTotal }}</div>
		</div>

		<div class="rounded-2xl border border-white/10 p-4">
			<div class="text-xs opacity-70">Saldo pendiente</div>
			<div class="mt-1 text-lg font-semibold">${{ s.summary!.pendingBalance }}</div>
		</div>
	</div>
	}
	}
	}

	<!-- LIST -->
	@if (vm$ | async; as vm) {
	<div class="flex gap-2 text-sm">
		<button class="rounded-xl border px-3 py-1 hover:bg-white/5" [class.border-white/20]="vm.status === 'PENDING'"
			[class.bg-white/10]="vm.status === 'PENDING'" [class.border-white/10]="vm.status !== 'PENDING'"
			(click)="setStatus('PENDING')">
			Pendientes
		</button>

		<button class="rounded-xl border px-3 py-1 hover:bg-white/5" [class.border-white/20]="vm.status === 'PAID'"
			[class.bg-white/10]="vm.status === 'PAID'" [class.border-white/10]="vm.status !== 'PAID'"
			(click)="setStatus('PAID')">
			Pagadas
		</button>
	</div>

	@if (vm.loading) {
	<div class="space-y-3">
		@for (_ of [1,2,3]; track _) {
		<div class="rounded-2xl border border-white/10 p-4">
			<ui-skeleton [width]="180" [height]="16" />
			<div class="mt-3 space-y-2">
				<ui-skeleton [width]="320" />
				<ui-skeleton [width]="260" />
			</div>
		</div>
		}
	</div>
	} @else {
	@if (vm.error) {
	<div class="rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm">
		{{ vm.error }}
	</div>
	} @else {
	<div class="space-y-3">
		@for (d of vm.debts; track d.id) {
		<a class="block rounded-2xl border border-white/10 p-4 hover:bg-white/5" [routerLink]="['/debts', d.id]">
			<div class="flex items-center justify-between">
				<div class="font-semibold">#{{ d.id }}</div>
				<div class="text-xs opacity-70">{{ d.status }}</div>
			</div>
			<div class="mt-2 text-sm opacity-80">${{ d.amount }}</div>
		</a>
		} @empty {
		<div class="rounded-2xl border border-white/10 p-4 opacity-80">
			No hay deudas en este filtro.
		</div>
		}
	</div>
	}
	}
	}
</section>