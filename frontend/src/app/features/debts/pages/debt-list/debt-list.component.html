<section class="page space-y-4">
	<ui-page-header title="Mis deudas" subtitle="Filtra, revisa el resumen y exporta cuando lo necesites.">
		<div actions class="flex flex-wrap gap-2">
			<a routerLink="/debts/new"
				class="rounded-xl border border-white/10 bg-white/10 px-4 py-2 text-sm font-medium hover:bg-white/15 transition">
				+ Nueva deuda
			</a>

			<ui-button variant="ghost" size="md" (click)="reload()">Recargar</ui-button>
		</div>
	</ui-page-header>

	@if (exportError) {
	<ui-alert tone="danger" [message]="exportError" />
	}

	@if (summaryVm$ | async; as s) {
	<ui-card padding="md">
		<div class="flex items-center justify-between gap-3">
			<div class="font-semibold">Resumen</div>
			<div class="flex gap-2">
				<ui-button variant="ghost" size="sm" [disabled]="exportLoading" (click)="export('json')">
					@if (exportLoading) { Exportando... } @else { Export JSON }
				</ui-button>
				<ui-button variant="ghost" size="sm" [disabled]="exportLoading" (click)="export('csv')">
					@if (exportLoading) { Exportando... } @else { Export CSV }
				</ui-button>
			</div>
		</div>

		<div class="mt-4">
			@if (s.loading) {
			<div class="grid grid-cols-2 gap-3 sm:grid-cols-3">
				@for (_ of [1,2,3,4,5,6]; track _) {
				<ui-card padding="sm">
					<ui-skeleton [width]="90" [height]="12" />
					<div class="mt-2"><ui-skeleton [width]="120" [height]="16" /></div>
				</ui-card>
				}
			</div>
			} @else {
			@if (s.error) {
			<ui-alert tone="danger" [message]="s.error" />
			} @else {
			<div class="grid grid-cols-2 gap-3 sm:grid-cols-3">
				<ui-card padding="sm">
					<div class="muted">Pendientes</div>
					<div class="text-lg font-semibold">{{ s.summary?.pendingCount ?? 0 }}</div>
				</ui-card>
				<ui-card padding="sm">
					<div class="muted">Pagadas</div>
					<div class="text-lg font-semibold">{{ s.summary?.paidCount ?? 0 }}</div>
				</ui-card>
				<ui-card padding="sm">
					<div class="muted">Total</div>
					<div class="text-lg font-semibold">{{ s.summary?.totalCount ?? 0 }}</div>
				</ui-card>
				<ui-card padding="sm">
					<div class="muted">Pendiente ($)</div>
					<div class="text-lg font-semibold">{{ s.summary?.pendingTotal ?? 0 }}</div>
				</ui-card>
				<ui-card padding="sm">
					<div class="muted">Pagado ($)</div>
					<div class="text-lg font-semibold">{{ s.summary?.paidTotal ?? 0 }}</div>
				</ui-card>
				<ui-card padding="sm">
					<div class="muted">Saldo ($)</div>
					<div class="text-lg font-semibold">{{ s.summary?.pendingBalance ?? 0 }}</div>
				</ui-card>
			</div>
			}
			}
		</div>
	</ui-card>
	}

	@if (vm$ | async; as vm) {
	<div class="flex flex-wrap items-center gap-2">
		<ui-button size="sm" [variant]="vm.status === 'PENDING' ? 'soft' : 'ghost'" (click)="setStatus('PENDING')">
			Pendientes
		</ui-button>

		<ui-button size="sm" [variant]="vm.status === 'PAID' ? 'soft' : 'ghost'" (click)="setStatus('PAID')">
			Pagadas
		</ui-button>

		<ui-badge tone="neutral">Filtro: {{ vm.status }}</ui-badge>
	</div>

	@if (vm.loading) {
	<div class="space-y-3">
		@for (_ of [1,2,3]; track _) {
		<ui-card padding="md">
			<ui-skeleton [width]="180" [height]="16" />
			<div class="mt-3 space-y-2">
				<ui-skeleton [width]="320" />
				<ui-skeleton [width]="260" />
			</div>
		</ui-card>
		}
	</div>
	} @else {
	@if (vm.error) {
	<ui-alert tone="danger" [message]="vm.error" />
	} @else {
	<div class="space-y-3">
		@for (d of vm.debts; track d.id) {
		<a class="block" [routerLink]="['/debts', d.id]">
			<ui-card padding="md" extraClass="hover:bg-white/10 transition">
				<div class="flex items-center justify-between gap-3">
					<div class="font-semibold truncate">Deuda #{{ d.id }}</div>
					<ui-badge [tone]="d.status === 'PAID' ? 'success' : 'warning'">{{ d.status }}</ui-badge>
				</div>
				<div class="mt-2 text-sm text-white/80">
					Monto: <span class="font-semibold">${{ d.amount }}</span>
				</div>
			</ui-card>
		</a>
		} @empty {
		<ui-card padding="md" extraClass="text-white/80">No hay deudas en este filtro.</ui-card>
		}
	</div>
	}
	}
	}
</section>